---
layout:     post
title:      "dw-methodology"
subtitle:   "数仓方法论"
date:       2019-08-24 23:00:00
author:     "Mickey"
header-img: "img/post-bg-nextgen-web-pwa.jpg"
tags:
    - 大数据
---

最近面试的时候，面试官建议我去看看数据仓库的方法论，我思考了一下，觉得自己以往搭建数仓确实是凭借自己对数据的感觉的，缺乏理论的支持，于是决定看一下数据仓库工具箱这本书，这篇文章用来记录一下感悟

* 维度模型设计的四个步骤

    1. 选择业务过程：我认为这就是理解自己的业务是在做什么
    2. 声明粒度：精确定义某个事实表的每一行在表示什么
    3. 确定纬度：确定度量环境中所有可能出现的单值描述符
    4. 确定事实：确定过程的度量是什么

    ![dw_1](/img/in-post/dw-methodology/dw_1.png)

* 零售业务
	
	拆解最细的粒度，POS 机上扫过的一件商品
	
	日期维度，产品维度，商店维度，出纳员维度，支付方式维度，金额，促销维度等等
	
	在 DW 中，尽量不要存储 NULL，可以用 UNKNOWN、Not Applicable 等标识显示表示

* 库存模型

	1. 库存周期快照（粒度是仓库中的产品）

		日期维度、产品维度、商店维度、库存数量、周期内出库数量...
		
	2. 库存事务（粒度是改变仓库的事务）

		日期维度、产品维度、仓库维度、库存事务类型维度...
		
	3. 库存累积快照（用于定义过程开始、结束以及期间的可区分的里程碑，在一条 record 上修改）

		接收日期维度、验收日期维度、入库日期维度、初始装运日期维度、最终装运日期维度，产品维度，仓库维度，供应商维度，两个阶段之间的时间差...

* 企业数据仓库总线矩阵

	纵轴是业务过程，横轴是维度，这样有助于实现 DW 的**一致性**，一致性非常重要
	
	![dw_2](/img/in-post/dw-methodology/dw_2.png)

* 有时候，在设计事实表的时候，会面对一个设计决策，是为所有的事务类型建立混合事务事实表，还是为每个事务类型建立不同的事实表，这个时候，可以思考下列问题

    * 用户的分析需求是什么？目标是通过最有效的方式给商业用户展现数据。商业用户最常用的分析数据的方式是什么？哪种方法能够最自然地与他们的业务相契合

    * 是否存在多个独特的业务过程

    * 多个源系统获取同样粒度的度量吗

* SCD（Slowly Changing Dimension，缓慢变化维度）的解决方法

    * 重写，直接在原始表上改写数据

    * 增加新行，新增 start\_time、end\_time 列来表示当前行的有效期

    * 增加新属性，在当前行上新增字段来表示历史属性

    * 增加微型维度，将频繁变化的属性，抽成一个微型维度表（属性的排列组合）

    * 微型维度 + 重写支架
        
        ![scd_5](/img/in-post/dw-methodology/scd-5.png)        

    * 重写 + 增加新行 + 新增新属性

        ![scd_6](/img/in-post/dw-methodology/scd-6.png)        

    * 重写 + 增加新行 + 新表

        ![scd_7](/img/in-post/dw-methodology/scd-7.png)        


